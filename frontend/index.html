<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B2B –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ - –ü–æ–∏—Å–∫ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html, body {
            height: 100%;
            width: 100%;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        #root {
            width: 100%;
            min-height: 100vh;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const STATUS_NAMES = {
            'draft': 'üìù –ß–µ—Ä–Ω–æ–≤–∏–∫',
            'submitted': '‚è≥ –ù–∞ –æ–±—Ä–∞–±–æ—Ç–∫–µ',
            'approved': '‚úì –û–¥–æ–±—Ä–µ–Ω–æ'
        };

        function App() {
            const [cabinet, setCabinet] = useState('user');
            const [requests, setRequests] = useState([]);
            const [tasks, setTasks] = useState([]);
            const [selectedRequest, setSelectedRequest] = useState(null);
            const [selectedTask, setSelectedTask] = useState(null);
            const [expandedPositions, setExpandedPositions] = useState(new Set());
            const [positionSuppliers, setPositionSuppliers] = useState({});
            const [loadingSuppliers, setLoadingSuppliers] = useState(new Set());
            const [loading, setLoading] = useState(false);
            const [file, setFile] = useState(null);
            const [uploadModalOpen, setUploadModalOpen] = useState(false);
            const [requestName, setRequestName] = useState('');
            const [showTextInput, setShowTextInput] = useState(false);
            const [textInput, setTextInput] = useState('');
            const [textRequestName, setTextRequestName] = useState('');

            const API_URL = 'http://127.0.0.1:8000/api/v1';

            const handleFileUpload = async (e) => {
                const selectedFile = e.target.files?.[0];
                if (!selectedFile) return;
                setFile(selectedFile);
                setUploadModalOpen(true);
                e.target.value = '';
            };

            const handleUploadConfirm = async () => {
                if (!requestName.trim()) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏');
                    return;
                }
                if (!file) return;

                setLoading(true);
                const formData = new FormData();
                formData.append('file', file);
                formData.append('request_name', requestName);

                try {
                    const response = await fetch(`${API_URL}/user/upload-and-create`, {
                        method: 'POST',
                        body: formData,
                    });
                    const data = await response.json();
                    
                    if (data.success) {
                        fetchUserRequests();
                        setUploadModalOpen(false);
                        setRequestName('');
                        setFile(null);
                    }
                } catch (error) {
                    console.error('Upload error:', error);
                    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞');
                } finally {
                    setLoading(false);
                }
            };

            const handleTextSubmit = async () => {
                if (!textRequestName.trim()) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏');
                    return;
                }
                if (!textInput.trim()) {
                    alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞—è–≤–∫–∏');
                    return;
                }

                setLoading(true);
                try {
                    const response = await fetch(`${API_URL}/user/create-from-text`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            text: textInput,
                            request_name: textRequestName
                        }),
                    });
                    const data = await response.json();
                    
                    if (data.success) {
                        fetchUserRequests();
                        setTextInput('');
                        setTextRequestName('');
                        setShowTextInput(false);
                        alert('‚úÖ –ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞! –ü–æ–∑–∏—Ü–∏–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω—ã');
                    } else {
                        alert('‚ùå –û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ç–µ–∫—Å—Ç'));
                    }
                } catch (error) {
                    console.error('Text submit error:', error);
                    alert('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞');
                } finally {
                    setLoading(false);
                }
            };

            const fetchUserRequests = async () => {
                try {
                    const response = await fetch(`${API_URL}/user/requests`);
                    const data = await response.json();
                    setRequests(data);
                } catch (error) {
                    console.error('Fetch error:', error);
                }
            };

            const handleRequestClick = async (request) => {
                try {
                    const response = await fetch(`${API_URL}/user/requests/${request.id}`);
                    const data = await response.json();
                    setSelectedRequest(data);
                    setExpandedPositions(new Set());
                } catch (error) {
                    console.error('Error:', error);
                }
            };

            const handleSubmitRequest = async (requestId) => {
                setLoading(true);
                try {
                    const response = await fetch(`${API_URL}/user/requests/${requestId}/submit`, {
                        method: 'POST',
                    });
                    const data = await response.json();
                    
                    if (data.success) {
                        fetchUserRequests();
                        if (selectedRequest?.id === requestId) {
                            const updatedRequest = await fetch(`${API_URL}/user/requests/${requestId}`);
                            const updatedData = await updatedRequest.json();
                            setSelectedRequest(updatedData);
                        }
                    }
                } catch (error) {
                    console.error('Submit error:', error);
                    alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏');
                } finally {
                    setLoading(false);
                }
            };

            const searchSuppliers = async (positionId, positionName) => {
                if (positionSuppliers[positionId]) {
                    return;
                }

                setLoadingSuppliers(prev => new Set(prev).add(positionId));
                try {
                    const response = await fetch(`${API_URL}/suppliers/search?keyword=${encodeURIComponent(positionName)}`);
                    const data = await response.json();
                    setPositionSuppliers(prev => ({
                        ...prev,
                        [positionId]: data.results || []
                    }));
                } catch (error) {
                    console.error('Search error:', error);
                    alert('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤');
                } finally {
                    setLoadingSuppliers(prev => {
                        const newSet = new Set(prev);
                        newSet.delete(positionId);
                        return newSet;
                    });
                }
            };

            const togglePositionExpand = async (positionId, positionName) => {
                const newExpanded = new Set(expandedPositions);
                
                if (newExpanded.has(positionId)) {
                    newExpanded.delete(positionId);
                } else {
                    newExpanded.add(positionId);
                    await searchSuppliers(positionId, positionName);
                }
                
                setExpandedPositions(newExpanded);
            };

            const loadAllSuppliers = async () => {
                if (!selectedRequest?.items) return;
                
                for (const position of selectedRequest.items) {
                    if (!positionSuppliers[position.pos]) {
                        await searchSuppliers(position.pos, position.name);
                    }
                }
            };

            const fetchModeratorTasks = async () => {
                try {
                    const response = await fetch(`${API_URL}/moderator/tasks`);
                    const data = await response.json();
                    setTasks(data);
                } catch (error) {
                    console.error('Fetch tasks error:', error);
                }
            };

            const handleTaskClick = async (task) => {
                try {
                    const response = await fetch(`${API_URL}/moderator/tasks/${task.id}`);
                    const data = await response.json();
                    setSelectedTask(data);
                    setExpandedPositions(new Set());
                } catch (error) {
                    console.error('Error:', error);
                }
            };

            const handleApproveTask = async (taskId) => {
                try {
                    const response = await fetch(`${API_URL}/moderator/tasks/${taskId}/approve`, {
                        method: 'POST',
                    });
                    const data = await response.json();
                    
                    if (data.success) {
                        fetchModeratorTasks();
                        setSelectedTask(null);
                    }
                } catch (error) {
                    console.error('Approve error:', error);
                    alert('–û—à–∏–±–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è');
                }
            };

            const handleRejectTask = async (taskId) => {
                const reason = prompt('–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è:');
                if (!reason) return;

                try {
                    const response = await fetch(`${API_URL}/moderator/tasks/${taskId}/reject`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ reason }),
                    });
                    const data = await response.json();
                    
                    if (data.success) {
                        fetchModeratorTasks();
                        setSelectedTask(null);
                    }
                } catch (error) {
                    console.error('Reject error:', error);
                    alert('–û—à–∏–±–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è');
                }
            };

            useEffect(() => {
                if (cabinet === 'user') {
                    fetchUserRequests();
                } else {
                    fetchModeratorTasks();
                }
            }, [cabinet]);

            return (
                <div style={{ minHeight: '100vh', backgroundColor: '#f5f5f5', padding: '20px', fontFamily: 'system-ui, -apple-system, sans-serif' }}>
                    <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
                        {/* Header */}
                        <div style={{ marginBottom: '30px', textAlign: 'center' }}>
                            <h1 style={{ fontSize: '32px', fontWeight: 'bold', marginBottom: '20px', color: '#333' }}>
                                üè¢ B2B –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞
                            </h1>
                            
                            <div style={{ display: 'flex', gap: '10px', justifyContent: 'center' }}>
                                <button
                                    onClick={() => setCabinet('user')}
                                    style={{
                                        padding: '12px 24px',
                                        fontSize: '16px',
                                        fontWeight: '600',
                                        border: 'none',
                                        borderRadius: '8px',
                                        cursor: 'pointer',
                                        backgroundColor: cabinet === 'user' ? '#2563eb' : '#e0e0e0',
                                        color: cabinet === 'user' ? 'white' : '#333',
                                        transition: 'all 0.2s',
                                    }}
                                >
                                    üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
                                </button>
                                <button
                                    onClick={() => setCabinet('moderator')}
                                    style={{
                                        padding: '12px 24px',
                                        fontSize: '16px',
                                        fontWeight: '600',
                                        border: 'none',
                                        borderRadius: '8px',
                                        cursor: 'pointer',
                                        backgroundColor: cabinet === 'moderator' ? '#2563eb' : '#e0e0e0',
                                        color: cabinet === 'moderator' ? 'white' : '#333',
                                        transition: 'all 0.2s',
                                    }}
                                >
                                    ‚öôÔ∏è –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä
                                </button>
                            </div>
                        </div>

                        {/* USER CABINET */}
                        {cabinet === 'user' && (
                            <div>
                                {!selectedRequest ? (
                                    <div>
                                        {/* Upload Section */}
                                        <div style={{
                                            backgroundColor: 'white',
                                            padding: '30px',
                                            borderRadius: '12px',
                                            marginBottom: '20px',
                                            boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                                        }}>
                                            <h2 style={{ fontSize: '20px', fontWeight: '600', marginBottom: '15px', color: '#333' }}>
                                                üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞—è–≤–∫—É
                                            </h2>
                                            <div style={{ display: 'flex', gap: '10px' }}>
                                                <label style={{
                                                    display: 'inline-block',
                                                    padding: '15px 30px',
                                                    backgroundColor: '#2563eb',
                                                    color: 'white',
                                                    fontSize: '16px',
                                                    fontWeight: '600',
                                                    borderRadius: '8px',
                                                    cursor: 'pointer',
                                                    transition: 'all 0.2s',
                                                }}
                                                    onMouseEnter={(e) => {
                                                        e.currentTarget.style.backgroundColor = '#1d4ed8';
                                                        e.currentTarget.style.transform = 'translateY(-2px)';
                                                    }}
                                                    onMouseLeave={(e) => {
                                                        e.currentTarget.style.backgroundColor = '#2563eb';
                                                        e.currentTarget.style.transform = 'translateY(0)';
                                                    }}
                                                >
                                                    ‚úì –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª
                                                    <input
                                                        type="file"
                                                        accept=".docx,.pdf,.xlsx"
                                                        onChange={handleFileUpload}
                                                        disabled={loading}
                                                        style={{ display: 'none' }}
                                                    />
                                                </label>
                                                <button
                                                    onClick={() => setShowTextInput(!showTextInput)}
                                                    style={{
                                                        padding: '15px 30px',
                                                        backgroundColor: '#22c55e',
                                                        color: 'white',
                                                        fontSize: '16px',
                                                        fontWeight: '600',
                                                        borderRadius: '8px',
                                                        border: 'none',
                                                        cursor: 'pointer',
                                                        transition: 'all 0.2s',
                                                    }}
                                                    onMouseEnter={(e) => {
                                                        e.currentTarget.style.backgroundColor = '#16a34a';
                                                        e.currentTarget.style.transform = 'translateY(-2px)';
                                                    }}
                                                    onMouseLeave={(e) => {
                                                        e.currentTarget.style.backgroundColor = '#22c55e';
                                                        e.currentTarget.style.transform = 'translateY(0)';
                                                    }}
                                                >
                                                    üìù –í—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç
                                                </button>
                                            </div>

                                            {showTextInput && (
                                                <div style={{ marginTop: '20px' }}>
                                                    <input
                                                        type="text"
                                                        placeholder="–ù–∞–∑–æ–≤–∏—Ç–µ –∑–∞—è–≤–∫—É..."
                                                        value={textRequestName}
                                                        onChange={(e) => setTextRequestName(e.target.value)}
                                                        style={{
                                                            width: '100%',
                                                            padding: '12px',
                                                            fontSize: '14px',
                                                            border: '2px solid #e0e0e0',
                                                            borderRadius: '8px',
                                                            marginBottom: '10px',
                                                            boxSizing: 'border-box',
                                                        }}
                                                    />
                                                    <textarea
                                                        placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–∫—É–ø–∫–∏ (–ø–æ–∑–∏—Ü–∏–∏ –±—É–¥—É—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ GROQ/Llama)..."
                                                        value={textInput}
                                                        onChange={(e) => setTextInput(e.target.value)}
                                                        style={{
                                                            width: '100%',
                                                            height: '120px',
                                                            padding: '12px',
                                                            fontSize: '14px',
                                                            border: '2px solid #e0e0e0',
                                                            borderRadius: '8px',
                                                            marginBottom: '10px',
                                                            boxSizing: 'border-box',
                                                            fontFamily: 'inherit',
                                                            resize: 'vertical',
                                                        }}
                                                    />
                                                    <button
                                                        onClick={handleTextSubmit}
                                                        disabled={loading || !textInput.trim()}
                                                        style={{
                                                            padding: '12px 24px',
                                                            fontSize: '14px',
                                                            fontWeight: '600',
                                                            border: 'none',
                                                            borderRadius: '8px',
                                                            backgroundColor: loading ? '#ccc' : '#22c55e',
                                                            color: 'white',
                                                            cursor: loading ? 'not-allowed' : 'pointer',
                                                            transition: 'all 0.2s',
                                                        }}
                                                        onMouseEnter={(e) => {
                                                            if (!loading) {
                                                                e.currentTarget.style.backgroundColor = '#16a34a';
                                                            }
                                                        }}
                                                        onMouseLeave={(e) => {
                                                            if (!loading) {
                                                                e.currentTarget.style.backgroundColor = '#22c55e';
                                                            }
                                                        }}
                                                    >
                                                        {loading ? '‚è≥ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ...' : 'üöÄ –†–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ç–µ–∫—Å—Ç'}
                                                    </button>
                                                </div>
                                            )}
                                        </div>

                                        {/* Upload Modal */}
                                        {uploadModalOpen && (
                                            <div style={{
                                                position: 'fixed',
                                                top: 0,
                                                left: 0,
                                                right: 0,
                                                bottom: 0,
                                                backgroundColor: 'rgba(0,0,0,0.5)',
                                                display: 'flex',
                                                alignItems: 'center',
                                                justifyContent: 'center',
                                                zIndex: 1000,
                                            }}>
                                                <div style={{
                                                    backgroundColor: 'white',
                                                    padding: '30px',
                                                    borderRadius: '12px',
                                                    width: '90%',
                                                    maxWidth: '500px',
                                                    boxShadow: '0 10px 40px rgba(0,0,0,0.2)',
                                                }}>
                                                    <h2 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '20px', color: '#333' }}>
                                                        üìù –ù–∞–∑–æ–≤–∏—Ç–µ –∑–∞—è–≤–∫—É
                                                    </h2>
                                                    <p style={{ fontSize: '14px', color: '#666', marginBottom: '20px' }}>
                                                        –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ (–∑–∞–∫—É–ø–∫–∏) –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
                                                    </p>
                                                    <input
                                                        type="text"
                                                        placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ó–∞–∫—É–ø–∫–∞ —Ç—Ä—É–± –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –ê"
                                                        value={requestName}
                                                        onChange={(e) => setRequestName(e.target.value)}
                                                        style={{
                                                            width: '100%',
                                                            padding: '12px',
                                                            fontSize: '14px',
                                                            border: '2px solid #e0e0e0',
                                                            borderRadius: '8px',
                                                            marginBottom: '20px',
                                                            boxSizing: 'border-box',
                                                        }}
                                                        onKeyPress={(e) => {
                                                            if (e.key === 'Enter') {
                                                                handleUploadConfirm();
                                                            }
                                                        }}
                                                    />
                                                    <div style={{ display: 'flex', gap: '10px' }}>
                                                        <button
                                                            onClick={() => {
                                                                setUploadModalOpen(false);
                                                                setRequestName('');
                                                                setFile(null);
                                                            }}
                                                            style={{
                                                                flex: 1,
                                                                padding: '12px',
                                                                fontSize: '14px',
                                                                fontWeight: '600',
                                                                border: '2px solid #e0e0e0',
                                                                backgroundColor: 'white',
                                                                color: '#333',
                                                                borderRadius: '8px',
                                                                cursor: 'pointer',
                                                                transition: 'all 0.2s',
                                                            }}
                                                            onMouseEnter={(e) => {
                                                                e.currentTarget.style.backgroundColor = '#f0f0f0';
                                                            }}
                                                            onMouseLeave={(e) => {
                                                                e.currentTarget.style.backgroundColor = 'white';
                                                            }}
                                                        >
                                                            –û—Ç–º–µ–Ω–∞
                                                        </button>
                                                        <button
                                                            onClick={handleUploadConfirm}
                                                            disabled={loading || !requestName.trim()}
                                                            style={{
                                                                flex: 1,
                                                                padding: '12px',
                                                                fontSize: '14px',
                                                                fontWeight: '600',
                                                                border: 'none',
                                                                backgroundColor: loading ? '#ccc' : '#2563eb',
                                                                color: 'white',
                                                                borderRadius: '8px',
                                                                cursor: loading ? 'not-allowed' : 'pointer',
                                                                transition: 'all 0.2s',
                                                            }}
                                                            onMouseEnter={(e) => {
                                                                if (!loading) {
                                                                    e.currentTarget.style.backgroundColor = '#1d4ed8';
                                                                }
                                                            }}
                                                            onMouseLeave={(e) => {
                                                                if (!loading) {
                                                                    e.currentTarget.style.backgroundColor = '#2563eb';
                                                                }
                                                            }}
                                                        >
                                                            {loading ? '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...' : '‚úì –ó–∞–≥—Ä—É–∑–∏—Ç—å'}
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {/* Requests List */}
                                        <div style={{
                                            backgroundColor: 'white',
                                            padding: '30px',
                                            borderRadius: '12px',
                                            boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                                        }}>
                                            <h2 style={{ fontSize: '20px', fontWeight: '600', marginBottom: '20px', color: '#333' }}>
                                                üìã –í–∞—à–∏ –∑–∞—è–≤–∫–∏
                                            </h2>
                                            {requests.length === 0 ? (
                                                <p style={{ color: '#999' }}>–ù–µ—Ç –∑–∞—è–≤–æ–∫</p>
                                            ) : (
                                                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>
                                                    {requests.map(req => (
                                                        <div
                                                            key={req.id}
                                                            onClick={() => handleRequestClick(req)}
                                                            style={{
                                                                padding: '15px',
                                                                borderLeft: '4px solid #2563eb',
                                                                backgroundColor: '#f9fafb',
                                                                borderRadius: '8px',
                                                                cursor: 'pointer',
                                                                transition: 'all 0.2s',
                                                                border: '1px solid #e0e0e0',
                                                            }}
                                                            onMouseEnter={(e) => {
                                                                e.currentTarget.style.backgroundColor = '#f0f4f8';
                                                            }}
                                                            onMouseLeave={(e) => {
                                                                e.currentTarget.style.backgroundColor = '#f9fafb';
                                                            }}
                                                        >
                                                            <div style={{ fontWeight: '600', color: '#333' }}>{req.request_name || req.filename}</div>
                                                            <div style={{ fontSize: '14px', color: '#666' }}>
                                                                –°—Ç–∞—Ç—É—Å: <span style={{ fontWeight: '600' }}>{STATUS_NAMES[req.status] || req.status}</span> | –ü–æ–∑–∏—Ü–∏–π: {req.items?.length || 0}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                ) : (
                                    <div>
                                        <button
                                            onClick={() => setSelectedRequest(null)}
                                            style={{
                                                marginBottom: '20px',
                                                padding: '10px 20px',
                                                fontSize: '14px',
                                                fontWeight: '600',
                                                border: 'none',
                                                borderRadius: '8px',
                                                backgroundColor: '#e0e0e0',
                                                cursor: 'pointer',
                                                color: '#333',
                                            }}
                                        >
                                            ‚Üê –ù–∞–∑–∞–¥
                                        </button>

                                        <div style={{
                                            backgroundColor: 'white',
                                            padding: '30px',
                                            borderRadius: '12px',
                                            marginBottom: '20px',
                                            boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                                        }}>
                                            <h2 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '10px', color: '#333' }}>
                                                {selectedRequest.request_name || selectedRequest.filename}
                                            </h2>
                                            <div style={{
                                                padding: '15px',
                                                backgroundColor: selectedRequest.status === 'draft' ? '#fef3c7' : selectedRequest.status === 'submitted' ? '#dbeafe' : '#d1fae5',
                                                borderRadius: '8px',
                                                marginBottom: '20px',
                                            }}>
                                                <p style={{ margin: 0, fontSize: '14px', fontWeight: '600', color: '#333' }}>
                                                    –°—Ç–∞—Ç—É—Å: <span style={{
                                                        padding: '4px 12px',
                                                        backgroundColor: selectedRequest.status === 'draft' ? '#fbbf24' : selectedRequest.status === 'submitted' ? '#60a5fa' : '#34d399',
                                                        color: 'white',
                                                        borderRadius: '6px',
                                                        fontSize: '12px',
                                                        fontWeight: 'bold',
                                                    }}>
                                                        {STATUS_NAMES[selectedRequest.status] || selectedRequest.status}
                                                    </span>
                                                </p>
                                            </div>

                                            {selectedRequest.status === 'draft' && (
                                                <button
                                                    onClick={() => handleSubmitRequest(selectedRequest.id)}
                                                    disabled={loading}
                                                    style={{
                                                        padding: '12px 24px',
                                                        fontSize: '16px',
                                                        fontWeight: '600',
                                                        border: 'none',
                                                        borderRadius: '8px',
                                                        backgroundColor: loading ? '#ccc' : '#2563eb',
                                                        color: 'white',
                                                        cursor: loading ? 'not-allowed' : 'pointer',
                                                        transition: 'all 0.2s',
                                                    }}
                                                    onMouseEnter={(e) => {
                                                        if (!loading) {
                                                            e.currentTarget.style.backgroundColor = '#1d4ed8';
                                                            e.currentTarget.style.transform = 'translateY(-2px)';
                                                        }
                                                    }}
                                                    onMouseLeave={(e) => {
                                                        if (!loading) {
                                                            e.currentTarget.style.backgroundColor = '#2563eb';
                                                            e.currentTarget.style.transform = 'translateY(0)';
                                                        }
                                                    }}
                                                >
                                                    {loading ? '‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞...' : 'üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É'}
                                                </button>
                                            )}
                                        </div>

                                        {selectedRequest.items && selectedRequest.items.length > 0 && (
                                            <div style={{
                                                backgroundColor: 'white',
                                                padding: '30px',
                                                borderRadius: '12px',
                                                boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                                            }}>
                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                                                    <h2 style={{ fontSize: '20px', fontWeight: '600', color: '#333' }}>
                                                        üì¶ –ü–æ–∑–∏—Ü–∏–∏
                                                    </h2>
                                                    <button
                                                        onClick={loadAllSuppliers}
                                                        disabled={Object.keys(positionSuppliers).length === selectedRequest.items.length}
                                                        style={{
                                                            padding: '10px 20px',
                                                            fontSize: '14px',
                                                            fontWeight: '600',
                                                            border: 'none',
                                                            borderRadius: '8px',
                                                            backgroundColor: Object.keys(positionSuppliers).length === selectedRequest.items.length ? '#d0d0d0' : '#22c55e',
                                                            color: 'white',
                                                            cursor: Object.keys(positionSuppliers).length === selectedRequest.items.length ? 'not-allowed' : 'pointer',
                                                            transition: 'all 0.2s',
                                                        }}
                                                        onMouseEnter={(e) => {
                                                            if (Object.keys(positionSuppliers).length !== selectedRequest.items.length) {
                                                                e.currentTarget.style.backgroundColor = '#16a34a';
                                                                e.currentTarget.style.transform = 'translateY(-2px)';
                                                            }
                                                        }}
                                                        onMouseLeave={(e) => {
                                                            if (Object.keys(positionSuppliers).length !== selectedRequest.items.length) {
                                                                e.currentTarget.style.backgroundColor = '#22c55e';
                                                                e.currentTarget.style.transform = 'translateY(0)';
                                                            }
                                                        }}
                                                    >
                                                        üìä –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
                                                    </button>
                                                </div>

                                                <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                                                    <thead>
                                                        <tr style={{ backgroundColor: '#f3f4f6', borderBottom: '2px solid #e5e7eb' }}>
                                                            <th style={{ padding: '12px', textAlign: 'left', fontWeight: '600', color: '#333' }}>‚Ññ</th>
                                                            <th style={{ padding: '12px', textAlign: 'left', fontWeight: '600', color: '#333' }}>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                                                            <th style={{ padding: '12px', textAlign: 'left', fontWeight: '600', color: '#333' }}>–ï–¥.–∏–∑–º.</th>
                                                            <th style={{ padding: '12px', textAlign: 'left', fontWeight: '600', color: '#333' }}>–ö–æ–ª-–≤–æ</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {selectedRequest.items.map((position) => (
                                                            <React.Fragment key={position.pos}>
                                                                <tr
                                                                    onClick={() => togglePositionExpand(position.pos, position.name)}
                                                                    style={{
                                                                        backgroundColor: expandedPositions.has(position.pos) ? '#e0e7ff' : '#fff',
                                                                        borderBottom: '1px solid #e5e7eb',
                                                                        cursor: 'pointer',
                                                                        transition: 'all 0.2s',
                                                                    }}
                                                                    onMouseEnter={(e) => {
                                                                        e.currentTarget.style.backgroundColor = '#f0f4f8';
                                                                    }}
                                                                    onMouseLeave={(e) => {
                                                                        e.currentTarget.style.backgroundColor = expandedPositions.has(position.pos) ? '#e0e7ff' : '#fff';
                                                                    }}
                                                                >
                                                                    <td style={{ padding: '12px', color: '#333', fontWeight: '600' }}>
                                                                        {expandedPositions.has(position.pos) ? '‚ñº' : '‚ñ∂'} {position.pos}
                                                                    </td>
                                                                    <td style={{ padding: '12px', color: '#333' }}>{position.name}</td>
                                                                    <td style={{ padding: '12px', color: '#666' }}>{position.unit}</td>
                                                                    <td style={{ padding: '12px', color: '#666', fontWeight: '600' }}>{position.qty}</td>
                                                                </tr>

                                                                {expandedPositions.has(position.pos) && (
                                                                    <tr style={{ backgroundColor: '#f0f9ff', borderBottom: '1px solid #e5e7eb' }}>
                                                                        <td colSpan={4} style={{ padding: '20px' }}>
                                                                            <div style={{ marginLeft: '20px' }}>
                                                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                                                                                    <h4 style={{ fontSize: '16px', fontWeight: '600', color: '#333', margin: 0 }}>
                                                                                        üè≠ –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏
                                                                                    </h4>
                                                                                    {loadingSuppliers.has(position.pos) && (
                                                                                        <span style={{ fontSize: '12px', color: '#666' }}>‚è≥ –ü–æ–∏—Å–∫...</span>
                                                                                    )}
                                                                                </div>

                                                                                {positionSuppliers[position.pos] && positionSuppliers[position.pos].length > 0 ? (
                                                                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(320px, 1fr))', gap: '15px' }}>
                                                                                        {positionSuppliers[position.pos].map(supplier => (
                                                                                            <div
                                                                                                key={supplier.id}
                                                                                                style={{
                                                                                                    padding: '16px',
                                                                                                    backgroundColor: 'white',
                                                                                                    borderRadius: '8px',
                                                                                                    border: '1px solid #e0e7ff',
                                                                                                    transition: 'all 0.2s',
                                                                                                    boxShadow: '0 1px 3px rgba(0,0,0,0.05)',
                                                                                                }}
                                                                                                onMouseEnter={(e) => {
                                                                                                    e.currentTarget.style.boxShadow = '0 8px 16px rgba(37, 99, 235, 0.15)';
                                                                                                    e.currentTarget.style.transform = 'translateY(-2px)';
                                                                                                    e.currentTarget.style.borderColor = '#2563eb';
                                                                                                }}
                                                                                                onMouseLeave={(e) => {
                                                                                                    e.currentTarget.style.boxShadow = '0 1px 3px rgba(0,0,0,0.05)';
                                                                                                    e.currentTarget.style.transform = 'translateY(0)';
                                                                                                    e.currentTarget.style.borderColor = '#e0e7ff';
                                                                                                }}
                                                                                            >
                                                                                                <div style={{ fontWeight: '700', fontSize: '15px', color: '#1e40af', marginBottom: '8px' }}>
                                                                                                    {supplier.name}
                                                                                                </div>
                                                                                                <div style={{ fontSize: '13px', color: '#666', lineHeight: '1.6' }}>
                                                                                                    <div style={{ marginBottom: '6px' }}>üìå –ò–ù–ù: <span style={{ fontWeight: '600', color: '#333' }}>{supplier.inn}</span></div>
                                                                                                    <div style={{ marginBottom: '6px' }}>
                                                                                                        üåê <a href={supplier.url} target="_blank" rel="noopener noreferrer" style={{ color: '#2563eb', textDecoration: 'none', fontWeight: '500' }}>
                                                                                                            –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç ‚Üí
                                                                                                        </a>
                                                                                                    </div>
                                                                                                    <div style={{ padding: '6px 0' }}>
                                                                                                        ‚≠ê –†–µ–π—Ç–∏–Ω–≥: <span style={{ fontWeight: '700', color: '#fbbf24' }}>{supplier.rating}/5.0</span>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                        ))}
                                                                                    </div>
                                                                                ) : (
                                                                                    <p style={{ color: '#999', padding: '20px', textAlign: 'center', backgroundColor: '#f9fafb', borderRadius: '8px' }}>
                                                                                        üîç –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
                                                                                    </p>
                                                                                )}
                                                                            </div>
                                                                        </td>
                                                                    </tr>
                                                                )}
                                                            </React.Fragment>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        )}

                        {/* MODERATOR CABINET */}
                        {cabinet === 'moderator' && (
                            <div>
                                {!selectedTask ? (
                                    <div style={{
                                        backgroundColor: 'white',
                                        padding: '30px',
                                        borderRadius: '12px',
                                        boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                                    }}>
                                        <h2 style={{ fontSize: '20px', fontWeight: '600', marginBottom: '20px', color: '#333' }}>
                                            ‚öôÔ∏è –ó–∞–¥–∞—á–∏ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é
                                        </h2>
                                        {tasks.length === 0 ? (
                                            <p style={{ color: '#999' }}>–ù–µ—Ç –∑–∞–¥–∞—á</p>
                                        ) : (
                                            <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>
                                                {tasks.map(task => (
                                                    <div
                                                        key={task.id}
                                                        onClick={() => handleTaskClick(task)}
                                                        style={{
                                                            padding: '15px',
                                                            borderLeft: '4px solid #f59e0b',
                                                            backgroundColor: '#fffbeb',
                                                            borderRadius: '8px',
                                                            cursor: 'pointer',
                                                            transition: 'all 0.2s',
                                                            border: '1px solid #fde68a',
                                                        }}
                                                        onMouseEnter={(e) => {
                                                            e.currentTarget.style.backgroundColor = '#fef3c7';
                                                        }}
                                                        onMouseLeave={(e) => {
                                                            e.currentTarget.style.backgroundColor = '#fffbeb';
                                                        }}
                                                    >
                                                        <div style={{ fontWeight: '600', color: '#333' }}>{task.filename}</div>
                                                        <div style={{ fontSize: '14px', color: '#666' }}>
                                                            –ü–æ–∑–∏—Ü–∏–π: {task.items_count} | –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {task.confidence}%
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                ) : (
                                    <div>
                                        <button
                                            onClick={() => setSelectedTask(null)}
                                            style={{
                                                marginBottom: '20px',
                                                padding: '10px 20px',
                                                fontSize: '14px',
                                                fontWeight: '600',
                                                border: 'none',
                                                borderRadius: '8px',
                                                backgroundColor: '#e0e0e0',
                                                cursor: 'pointer',
                                                color: '#333',
                                            }}
                                        >
                                            ‚Üê –ù–∞–∑–∞–¥
                                        </button>

                                        <div style={{
                                            backgroundColor: 'white',
                                            padding: '30px',
                                            borderRadius: '12px',
                                            marginBottom: '20px',
                                            boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                                        }}>
                                            <h2 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '10px', color: '#333' }}>
                                                {selectedTask.filename}
                                            </h2>
                                            <div style={{
                                                padding: '15px',
                                                backgroundColor: '#dbeafe',
                                                borderRadius: '8px',
                                                marginBottom: '20px',
                                            }}>
                                                <p style={{ margin: 0, fontSize: '14px', fontWeight: '600', color: '#333' }}>
                                                    –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è: <span style={{
                                                        padding: '4px 12px',
                                                        backgroundColor: '#60a5fa',
                                                        color: 'white',
                                                        borderRadius: '6px',
                                                        fontSize: '12px',
                                                        fontWeight: 'bold',
                                                    }}>
                                                        {selectedTask.confidence}%
                                                    </span>
                                                </p>
                                            </div>

                                            <div style={{ display: 'flex', gap: '10px' }}>
                                                <button
                                                    onClick={() => handleApproveTask(selectedTask.id)}
                                                    style={{
                                                        padding: '12px 24px',
                                                        fontSize: '16px',
                                                        fontWeight: '600',
                                                        border: 'none',
                                                        borderRadius: '8px',
                                                        backgroundColor: '#16a34a',
                                                        color: 'white',
                                                        cursor: 'pointer',
                                                        transition: 'all 0.2s',
                                                    }}
                                                    onMouseEnter={(e) => {
                                                        e.currentTarget.style.backgroundColor = '#15803d';
                                                        e.currentTarget.style.transform = 'translateY(-2px)';
                                                    }}
                                                    onMouseLeave={(e) => {
                                                        e.currentTarget.style.backgroundColor = '#16a34a';
                                                        e.currentTarget.style.transform = 'translateY(0)';
                                                    }}
                                                >
                                                    ‚úì –û–¥–æ–±—Ä–∏—Ç—å
                                                </button>
                                                <button
                                                    onClick={() => handleRejectTask(selectedTask.id)}
                                                    style={{
                                                        padding: '12px 24px',
                                                        fontSize: '16px',
                                                        fontWeight: '600',
                                                        border: 'none',
                                                        borderRadius: '8px',
                                                        backgroundColor: '#dc2626',
                                                        color: 'white',
                                                        cursor: 'pointer',
                                                        transition: 'all 0.2s',
                                                    }}
                                                    onMouseEnter={(e) => {
                                                        e.currentTarget.style.backgroundColor = '#b91c1c';
                                                        e.currentTarget.style.transform = 'translateY(-2px)';
                                                    }}
                                                    onMouseLeave={(e) => {
                                                        e.currentTarget.style.backgroundColor = '#dc2626';
                                                        e.currentTarget.style.transform = 'translateY(0)';
                                                    }}
                                                >
                                                    ‚úó –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                                                </button>
                                            </div>
                                        </div>

                                        {selectedTask.items && selectedTask.items.length > 0 && (
                                            <div style={{
                                                backgroundColor: 'white',
                                                padding: '30px',
                                                borderRadius: '12px',
                                                boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                                            }}>
                                                <h2 style={{ fontSize: '20px', fontWeight: '600', marginBottom: '20px', color: '#333' }}>
                                                    üì¶ –†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
                                                </h2>

                                                <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                                                    <thead>
                                                        <tr style={{ backgroundColor: '#f3f4f6', borderBottom: '2px solid #e5e7eb' }}>
                                                            <th style={{ padding: '12px', textAlign: 'left', fontWeight: '600', color: '#333' }}>‚Ññ</th>
                                                            <th style={{ padding: '12px', textAlign: 'left', fontWeight: '600', color: '#333' }}>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                                                            <th style={{ padding: '12px', textAlign: 'left', fontWeight: '600', color: '#333' }}>–ï–¥.–∏–∑–º.</th>
                                                            <th style={{ padding: '12px', textAlign: 'left', fontWeight: '600', color: '#333' }}>–ö–æ–ª-–≤–æ</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {selectedTask.items.map((item) => (
                                                            <tr key={item.pos} style={{ borderBottom: '1px solid #e5e7eb' }}>
                                                                <td style={{ padding: '12px', color: '#333', fontWeight: '600' }}>{item.pos}</td>
                                                                <td style={{ padding: '12px', color: '#333' }}>{item.name}</td>
                                                                <td style={{ padding: '12px', color: '#666' }}>{item.unit}</td>
                                                                <td style={{ padding: '12px', color: '#666', fontWeight: '600' }}>{item.qty}</td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>